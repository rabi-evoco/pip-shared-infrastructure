parameters:
  - name: subscription
    type: string

  - name: environment
    type: string

  - name: resourceGroup
    type: string

  - name: builtFrom
    type: string
    default: ''

  - name: project
    type: string
    default: ''

steps:
  - bash: echo ${{ parameters.environment }} && echo ${{ parameters.project }}
    displayName: echo params
  - task: TerraformCLI@0
    displayName: Terraform plan
    inputs:
      command: plan
      workingDirectory: $(System.DefaultWorkingDirectory)/terraform/deployments/${{ parameters.environment }}
      environmentServiceName: ${{ parameters.subscription }}
      commandOptions: >
        -var-file="../../../environments/${{ parameters.environment }}.tfvars"
        -var-file="../../../environments/shared.tfvars"
        -out="tfplan-${{ parameters.environment }}"
        -var "resource_group=${{ parameters.resourceGroup }}"
        -var "environment=${{ parameters.environment }}"
        -var "la_nonprod_sub_id=$(la_nonprod_sub_id)"
        -var "la_prod_sub_id=$(la-prod-sub-id)"
        -var "la_sbox_sub_id=$(la-sbox-sub-id)"
        -var "builtFrom=${{ parameters.builtFrom }}"
        -var "project=${{ parameters.project }}"
